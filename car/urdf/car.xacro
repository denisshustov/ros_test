<?xml version="1.0"?>

<robot name="car" xmlns:xacro="http://www.ros.org/wiki/xacro" >
    <xacro:property name="radius" value="0.2" />
    <xacro:property name="wheel" value="wheel" />
    <xacro:include filename="$(find car)/urdf/car.gazebo" />

    <xacro:macro name="wheel_macro" params="rpy name joint_origin_xyz">
        <link name="${name}">

          <inertial>
            <origin xyz="0 0 0.0" rpy="${rpy}" />
            <mass value="1.0"/>
            <inertia ixx="1.0" ixy="1.0" ixz="1.0" iyy="1.0" iyz="1.0" izz="1.0"/>
          </inertial>

          <visual>
              <origin xyz="0 0 0" rpy="${rpy}" />
              <geometry>
                <cylinder length="0.1" radius="${radius}" />
              </geometry>
              <material name="black">
                <color rgba="0.05 0.05 0.05 1"/>
              <texture filename=""/>
            </material>
          </visual>

          <collision>
            <origin xyz="0 0 0" rpy="${rpy}" />
            <geometry>
              <cylinder length="0.1" radius="${radius}" />
            </geometry>
          </collision>

        </link>

        <joint name="joint_${name}" type="continuous">  <!--continuous--> <!--revolute-->
          <parent link="base_link"/>
          <child link="${name}"/>
          <origin xyz="${joint_origin_xyz}" rpy="0 0 0" />
          <axis xyz="0 1 0" rpy="0 0 0" />
          <limit upper="6.28" lower="-6.28" effort="1000" velocity="1000.00"/>
        </joint>

        <transmission name="trnasm_${name}">
          <type>transmission_interface/SimpleTransmission</type>
          <actuator name="act_${name}">
            <mechanicalReduction>1</mechanicalReduction>
          </actuator>
          <joint name="joint_${name}">
            <hardwareInterface>EffortJointInterface</hardwareInterface>
            <!--hardwareInterface>VelocityJointInterface</hardwareInterface-->
            <!--hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface-->
          </joint>
        </transmission>
    </xacro:macro>

  <!-- Used for fixing robot to Gazebo 'base_link' -->
  <link name="world"/>

  <joint name="fixed" type="fixed">
    <parent link="world"/>
    <child link="base_link"/>
  </joint>


  <!-- Base link -->
  <link name="base_link">
    <visual>
      <origin xyz="0 0 0.1" rpy="0 0 0" />
      <geometry>
          <box size="1 0.5 0.35"/>
      </geometry>
      <material name="yellow">
        <color rgba="0.8 0.8 0 1"/>
      </material>
    </visual>
  </link>

  <!-- Front Right Wheel -->
  <xacro:wheel_macro rpy="1.570795 0 0" name="f_r_${wheel}" joint_origin_xyz="0.25 -0.30 0"/>

  <!-- Back Right Wheel -->
  <xacro:wheel_macro rpy="1.570795 0 0" name="b_r_${wheel}" joint_origin_xyz="-0.25 -0.30 0"/>

  <!-- Front Left Wheel -->
  <xacro:wheel_macro rpy="1.570795 0 0" name="f_l_${wheel}" joint_origin_xyz="0.25 0.30 0"/>

  <!-- Back Left Wheel -->
  <xacro:wheel_macro rpy="1.570795 0 0" name="b_l_${wheel}" joint_origin_xyz="-0.25 0.30 0" />

</robot>